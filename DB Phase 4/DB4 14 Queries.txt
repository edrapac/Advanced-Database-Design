1. List all employees (employee number, first and last names, age, 
and commission details) from Illinois.

SELECT e.employee_id, e.employee.first_name, e.employee.last_name,e.employee.age() AGE, e.employee.comission COMMISSION, a.state
FROM O_employee e, TABLE (address) a
WHERE a.state = 'IL'

2. Find number of employees and their total 
commissions. 

SELECT COUNT(e.employee_id) TOTAL_EMPLOYEES, SUM(e.employee.commission) TOTAL_COMMISSION
FROM O_employee e

3. List all employees whose commission is greater than the average 
commission, and show by how much. 

SELECT e.employee_id EMP_NO, e.employee.first_name FNAME,
    e.employee.last_name LNAME,e.employee.commission COMMISSION,
    s.AVGS AVG_COM,
    (e.employee.commission - s.AVGS) DIFFERENCE
    FROM
    (select avg(e.employee.commission) AVGS
            from o_employee e) s,
            o_employee e 
    WHERE e.employee.commission > s.AVGS

4. Find employee whose commission is larger than commission of
the employee with ID '00002'.

SELECT e.employee_id EMP_NO, e.employee.first_name FNAME,
    e.employee.last_name LNAME,e.employee.commission COMMISSION
    FROM o_employee e
    WHERE e.employee_id NOT LIKE '00002'
    AND e.employee.commission IS NOT NULL;

5. List numbers and first names of employee 
who deal with the customers and the customers they deal with.

SELECT distinct e.employee_id , o.customer_id, e.employee.first_name FNAME,
    e.employee.last_name LNAME,  c.customer.first_name, 
    c.customer.last_name 
    FROM o_employee e
    JOIN customer_order o on o.employee_id = e.employee_id
    JOIN o_CUSTOMER c on c.customer_id = o.customer_id

6. Find number of customers handled by each employee member.

SELECT e.employee_id , count(o.customer_id) CUST_COUNT, e.employee.first_name FNAME,
    e.employee.last_name LNAME
    FROM o_employee e
    JOIN customer_order o on o.employee_id = e.employee_id
    JOIN o_CUSTOMER c on c.customer_id = o.customer_id
    GROUP BY e.employee_id,e.employee.first_name,
    e.employee.last_name

7. List all employees who are either dealing with customers or 
not, and also their customer names. 

SELECT e.employee_id , count(o.customer_id) CUST_COUNT, e.employee.first_name FNAME,
    e.employee.last_name LNAME, c.customer.first_name
    FROM o_employee e
    left JOIN customer_order o on o.employee_id = e.employee_id
    left JOIN o_CUSTOMER c on c.customer_id = o.customer_id
    GROUP BY e.employee_id,e.employee.first_name,
    e.employee.last_name, c.customer.first_name

8. List employees have helped customers fulfill orders and which employees don't have orders as well as order count

SELECT e.employee_id , count(o.customer_id) ORDER_COUNT, e.employee.first_name FNAME,
    e.employee.last_name LNAME
    FROM o_employee e
    LEFT JOIN customer_order o on o.employee_id = e.employee_id
    GROUP BY e.employee_id,e.employee.first_name,
    e.employee.last_name

9. List employees have helped customers fulfill orders and which employees don't have orders as well as order count and the total commission generated by each employee

SELECT e.employee_id , count(o.customer_id) ORDER_COUNT, e.employee.first_name FNAME,
    e.employee.last_name LNAME, e.employee.commission
    FROM o_employee e
    LEFT JOIN customer_order o on o.employee_id = e.employee_id
    GROUP BY e.employee_id,e.employee.first_name,
    e.employee.last_name, e.employee.commission

10. List all cities where there is either an employee in that city 
or there is a customer from that city.

SELECT e.city
from o_employee e, TABLE(ADDRESS) e
UNION
SELECT c.city
FROM o_customer c, TABLE(ADDRESS) c;

101 rows selected 

11. Show the top three customers according to their total sales. 

With qty1 as
(
    select count(o.customer_id) qty, o.customer_id cust_id
    from customer_order o
    group by o.customer_id
)

SELECT t.rank, t.customer, t.first_name, t.total
FROM
(
SELECT RANK() over (order by sum(qty1.qty*paint.price)desc) as RANK,
c.customer_id CUSTOMER, c.customer.first_name first_name, sum((count(o.customer_id)*paint.price)) TOTAL
FROM o_customer c, customer_order o, painting_order p, painting paint, qty1
WHERE c.customer_id = o.customer_id
AND qty1.cust_id = o.customer_id
AND o.order_id = p.order_id
AND p.painting_id = paint.painting_id
GROUP BY c.CUSTOMER_ID, c.customer.first_name,qty1.qty) t
WHERE t.rank <=3;

12. Show employee Id, employee full name (last, first), city, 
state, and their position. Your result should be sorted 
according to Sales Manager first, Sales second, Finance  third, 
and the others as fourth. (Hint: uses the DECODE to order the 
result) 

select e.employee_id EMPLOYEE_NO, e.employee.first_name FNAME, e.employee.last_name LNAME,
a.city CITY, a.state ST, e.employee.position POSITION
from o_employee e, TABLE (address) a
order by Decode(e.employee.position, 'Sales Manager', 1,
                'Sales', 2,
                'Finance', 3,
                4), e.employee_id
